<div class="notification" *ngIf="error">
  <div class="notification-content">
    <div class="error-message">{{ error }}</div>
    <div class="error-code" *ngIf="errorCode">{{ errorCode }}</div>
    <div class="error-details" *ngIf="actionDetails">{{ actionDetails }}</div>
  </div>
  <button class="dismiss-button" (click)="dismissError()">✕</button>
</div>

<div class="container">
  <div class="profiles">
    <div class="profile-header" (click)="toggleProfileExpanded()">
      <h2>Mock Data Profile: <strong>{{ currentProfile }}</strong></h2>
      <span class="expand-icon">{{ profileExpanded ? '−' : '+' }}</span>
    </div>
    <div class="profile-content" *ngIf="profileExpanded">
      <div class="profile-info">
        <select [(ngModel)]="currentProfile" (ngModelChange)="selectProfile($event)">
          <option *ngFor="let profile of availableProfiles" [value]="profile">{{ profile }}</option>
        </select>
      </div>
      <div class="form">
        <input type="text" [(ngModel)]="newProfileName" placeholder="New Profile Name">
        <button (click)="createProfile()" [disabled]="loading.profile || !newProfileName">
          {{ loading.profile ? 'Creating...' : 'Create Profile' }}
        </button>
      </div>
    </div>
  </div>

  <div class="clusters">
    <h2>Clusters</h2>
    <div class="form">
      <input type="text" [(ngModel)]="username" placeholder="Username">
      <input type="password" [(ngModel)]="password" placeholder="Password">
      <button (click)="createNewCluster()" [disabled]="loading.cluster">
        {{ loading.cluster ? 'Creating...' : 'Create Cluster' }}
      </button>
    </div>
    <div class="cluster-list list" *ngIf="state?.clusters?.length">
      <div class="cluster-item" *ngFor="let cluster of state?.clusters">
        <div class="cluster-info" [class.selected]="cluster === state?.selectedTestOwner" (click)="selectCluster(cluster)">
          <span class="cluster-name">{{ cluster.username }}</span>
          <button (click)="disposeCluster(cluster); $event.stopPropagation()" [disabled]="loading.cluster">
            {{ loading.cluster ? 'Disposing...' : 'Dispose' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="namespaces" *ngIf="state?.selectedTestOwner">
    <h2>Namespaces</h2>
    <div class="form">
      <input type="text" [(ngModel)]="namespaceName" placeholder="Namespace Name">
      <button (click)="createNewNamespace()" [disabled]="loading.namespace">
        {{ loading.namespace ? 'Creating...' : 'Create New Namespace' }}
      </button>
    </div>
    <div class="list">
      <div *ngFor="let namespace of state?.namespaces"
           [class.selected]="namespace.id === state?.selectedNamespace?.id"
           (click)="selectNamespace(namespace)">
        {{ namespace.name }}
      </div>
    </div>
  </div>

  <div class="invitations" *ngIf="state?.selectedNamespace">
    <h2>Invitations</h2>
    <div class="form">
      <input type="email" [(ngModel)]="email" placeholder="Email">
      <button (click)="createNewInvitation()" [disabled]="loading.invitation">
        {{ loading.invitation ? 'Creating...' : 'Create New Invitation' }}
      </button>
    </div>
    <div class="list">
      <div *ngFor="let invitation of state?.currentNamespaceInvitations"
           [class.accepted]="invitation.accepted">
        {{ invitation.email }}
        <button *ngIf="!invitation.accepted"
                (click)="acceptInvitation(invitation)"
                [disabled]="loading.acceptInvitation">
          {{ loading.acceptInvitation ? 'Accepting...' : 'Accept' }}
        </button>
      </div>
    </div>
  </div>

  <div class="users" *ngIf="state?.selectedNamespace">
    <h2>Users</h2>
    <div class="list">
      <div class="users-list">
        <div *ngFor="let user of state?.selectedNamespace?.users || []"
             class="user-item">
          <span>{{ user.name }}</span>
          <div class="user-actions">
            <button (click)="addToPaidBy(user)" 
                    class="add-btn">
              Add as Payer
            </button>
            <button (click)="addToBenefitors(user)"
                    class="add-btn">
              Add as Benefitor
            </button>
          </div>
        </div>
      </div>

      <div class="payment-event-form" *ngIf="paymentEvent.paidBy.length || paymentEvent.benefitors.length">
        <div class="payers-section" *ngIf="paymentEvent.paidBy.length">
          <h3>Payers</h3>
          <div class="payer-list">
            <div *ngFor="let payer of paymentEvent.paidBy; let i = index" class="payer-item">
              <span>{{ payer.user.name }}</span>
              <div class="amount-inputs">
                <input type="number" [(ngModel)]="payer.amount" placeholder="Amount">
                <input type="text" [(ngModel)]="payer.currency" placeholder="Currency">
              </div>
              <button (click)="removeFromPaidBy(payer.user, i)" class="remove-btn">Remove</button>
            </div>
          </div>
        </div>

        <div class="benefitors-section" *ngIf="paymentEvent.benefitors.length">
          <h3>Benefitors</h3>
          <div class="benefitor-list">
            <div *ngFor="let benefitor of paymentEvent.benefitors; let i = index" class="benefitor-item">
              <span>{{ benefitor.user.name }}</span>
              <div class="amount-inputs">
                <input type="number" [(ngModel)]="benefitor.amount" placeholder="Amount">
                <input type="text" [(ngModel)]="benefitor.currency" placeholder="Currency">
              </div>
              <button (click)="removeFromBenefitors(benefitor.user, i)" class="remove-btn">Remove</button>
            </div>
          </div>
        </div>

        <div class="form-footer">
          <input type="text" [(ngModel)]="paymentEvent.description" placeholder="Description">
          <textarea [(ngModel)]="paymentEvent.notes" placeholder="Notes"></textarea>
          <button (click)="addPaymentEvent()" 
                  [disabled]="!isPaymentValid()">
            {{ loading.paymentEvent ? 'Adding...' : 'Add Payment Event' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
