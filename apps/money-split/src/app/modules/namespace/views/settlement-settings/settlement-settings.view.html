
<page
    [isLoading]="isLoading"
    [notifications$]="notification$"
    class="with-page-header"
>
    <namespace-header
        page-header
        *ngIf="view$ | async as view"
        [name]="view.namespace.name"
        [avatarId]="view.namespace.avatarId"
        (backNavigation)="routingService.goToNamespaceView()"
    ></namespace-header>
    <ng-container
        *ngIf="view$ | async as view"
    >
        <h4>
            {{ 'settlementSettings' | translate }}
        </h4>
        <div>
          <div 
            class="list-item box secondary"
            (click)="expandPaymentEvents = !expandPaymentEvents"
            style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;"
          >
            <span
              class="p-lr-normal"
            >
              <h5 *ngIf="allSelected">{{ 'allPayments' | translate }}</h5>
              <h5 *ngIf="!allSelected">{{ 'customPayments' | translate }}</h5>
            </span>
            <button
                type="button"
                data-test="expand-payment-events-btn"
                class="icon-btn m-r-normal"
            >
              <i 
                class="fa-solid"
                [class.fa-chevron-down]="!expandPaymentEvents"
                [class.fa-chevron-up]="expandPaymentEvents"  
              ></i>
            </button>
          </div>
          <payment-event-list
              *ngIf="expandPaymentEvents"
              [paymentEvents]="{ 
                  paymentEvents: view.paymentEventsToSettle,
                  controls: view.checkboxes
              }"
              (selectPaymentEvent)="routingService
                  .goToEditRecordView($event.id)"
          ></payment-event-list>
        </div>
        <div
          class="m-t-normal"
        >
          <div 
            class="list-item box secondary"
            style="display: flex; 
                    justify-content: space-between; 
                    align-items: 
                    center; cursor: pointer;"
          >
            <span
              class="p-lr-normal"
            >
              <h5 *ngIf="view.currencies.length === 1">
                {{ view.currencies[0] }}
                </h5>
              <h5 *ngIf="view.currencies.length !== 1
                     && view.separatedSettlementPerCurrencyControl.value">
                {{ 'separatedSettlementPerCurrency' | translate }}
              </h5>
              <h5 *ngIf="view.currencies.length !== 1
                     && !view.separatedSettlementPerCurrencyControl.value">
                {{ 'manageCurrencies' | translate }}
              </h5>
            </span>
            <slide-switcher
              class="m-r-normal"
              *ngIf="view.currencies.length !== 1"
              [formControl]="view.separatedSettlementPerCurrencyControl"
              data-test="complex-mode-switcher"
            ></slide-switcher>
          </div>
          <div
            *ngIf="!view.separatedSettlementPerCurrencyControl.value"
          >
            <h5>
              {{ 'selectMainCurrency' | translate }}
            </h5>
            <ul
              style="display: flex; flex-wrap: wrap; gap: 10px;"
            >
              <li
                *ngFor="let currency of view.currencies"
                class="list-item box secondary p-normal"
                [class.secondary-fill]="view.mainCurrencyControl.value === currency"
                style="width: 20%; text-align: center;"
                (click)="view.mainCurrencyControl.setValue(currency)"
              >
                {{ currency }}
              </li>
            </ul>
          </div>
          <form
            *ngIf="!view.separatedSettlementPerCurrencyControl.value"
          >
            <div
                *ngFor="let currency of view.currencies"
                class="inline-form-group"
                data-test="amount-form"
                [class.display-none]="view.mainCurrencyControl.value === currency"
            >
                <div 
                  class="input-group w-6"
                  *ngIf="view.currenciesFb.get(currency) as control"  
                >
                  <p>
                    {{ 'currencyConversion' 
                     | translate:{ 
                        currency: currency 
                        } 
                    }}
                  </p>
                  <input
                      [formControl]="$any(control)" 
                      type="number"
                      [name]="'value-currency-' + currency | htmlAttribute"
                      [class.error]="control.errors"
                  >
                </div>
                <div class="input-group w-3">
                  <p>
                    {{ view.mainCurrencyControl.value }}
                  </p>                  
                </div>
            </div>
          </form>
        </div>
        <button
            (click)="confirm(view)"
            data-test="settle-setting-confirm-button"
            style="width: 100%;"
            class="m-t-normal"
            [disabled]="!view.currenciesFb.valid"
        >
            {{ 'confirm' | translate }}
        </button>
    </ng-container>
</page>